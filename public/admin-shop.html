<!DOCTYPE html>
<html lang="eng">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Apex Gym Shop Management" />
    <meta name="keywords" content="Gym, Admin, Shop, Management" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Apex Gym - Shop Management</title>

    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css?family=Muli:300,400,500,600,700,800,900&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Oswald:300,400,500,600,700&amp;display=swap"
      rel="stylesheet"
    />

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="css/style.css" type="text/css" />

    <style>
      /* Global black background */
      body {
        background-color: #000;
        color: #fff;
        min-height: 100vh;
      }

      .admin-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
        border-bottom: 1px solid #333;
        margin-bottom: 30px;
      }

      .admin-logo {
        display: flex;
        align-items: center;
      }

      .admin-logo img {
        max-width: 80px;
        margin-right: 15px;
      }

      .admin-title h1 {
        color: #e53637;
        margin: 0;
        font-size: 24px;
      }

      .admin-nav {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
      }

      .nav-btn {
        background: #1a1a1a;
        color: #b7b7b7;
        border: 1px solid #333;
        padding: 10px 20px;
        border-radius: 4px;
        text-decoration: none;
        transition: all 0.3s;
      }

      .nav-btn:hover,
      .nav-btn.active {
        background: #e53637;
        color: #fff;
        text-decoration: none;
      }

      .admin-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .search-box {
        display: flex;
        gap: 10px;
      }

      .search-input {
        background: #1a1a1a;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 10px 15px;
        color: #fff;
        min-width: 300px;
      }

      .search-input:focus {
        outline: none;
        border-color: #e53637;
      }

      .btn-primary {
        background: #e53637;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-primary:hover {
        background: #fff;
        color: #e53637;
      }

      /* Updated Products Grid - 4 per row with shorter cards */
      .products-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }

      @media (max-width: 1200px) {
        .products-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      @media (max-width: 768px) {
        .products-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 480px) {
        .products-grid {
          grid-template-columns: 1fr;
        }
      }

      .product-card {
        background: #1a1a1a;
        border-radius: 8px;
        border: 1px solid #333;
        overflow: hidden;
        transition: all 0.3s;
        display: flex;
        flex-direction: column;
        height: 280px;
      }

      .product-card:hover {
        transform: translateY(-3px);
        border-color: #e53637;
      }

      .product-image {
        height: 120px;
        background: #222;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .out-of-stock {
        position: absolute;
        top: 8px;
        right: 8px;
        background: #e53637;
        color: #fff;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 10px;
        font-weight: 600;
      }

      .product-details {
        padding: 15px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }

      .product-name {
        color: #fff;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
        line-height: 1.2;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        min-height: 32px;
      }

      .product-description {
        color: #b7b7b7;
        font-size: 12px;
        margin-bottom: 12px;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        flex-grow: 1;
      }

      .product-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .product-price {
        color: #e53637;
        font-size: 16px;
        font-weight: 700;
      }

      .product-stock {
        color: #b7b7b7;
        font-size: 12px;
      }

      .product-actions {
        display: flex;
        gap: 8px;
        margin-top: auto;
      }

      .btn-edit {
        background: #333;
        color: #fff;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        flex: 1;
        transition: all 0.3s;
        font-size: 12px;
      }

      .btn-edit:hover {
        background: #555;
      }

      .btn-delete {
        background: #e53637;
        color: #fff;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        flex: 1;
        transition: all 0.3s;
        font-size: 12px;
      }

      .btn-delete:hover {
        background: #c42b2c;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #b7b7b7;
        grid-column: 1 / -1;
      }

      .empty-state i {
        font-size: 48px;
        margin-bottom: 20px;
        color: #333;
      }

      /* Pagination Styles */
      .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin: 30px 0;
        flex-wrap: wrap;
      }

      .page-btn {
        background: #1a1a1a;
        color: #fff;
        border: 1px solid #333;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
      }

      .page-btn:hover:not(.disabled) {
        background: #e53637;
        border-color: #e53637;
        text-decoration: none;
      }

      .page-btn.active {
        background: #e53637;
        border-color: #e53637;
      }

      .page-btn.disabled {
        background: #333;
        color: #666;
        cursor: not-allowed;
      }

      .page-info {
        color: #b7b7b7;
        margin: 0 15px;
        font-size: 14px;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
      }

      .modal-content {
        background: #1a1a1a;
        margin: 5% auto;
        padding: 30px;
        border-radius: 10px;
        width: 90%;
        max-width: 600px;
        border: 2px solid #e53637;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
      }

      .modal-title {
        color: #e53637;
        font-size: 24px;
        margin: 0;
      }

      .close-modal {
        background: none;
        border: none;
        color: #b7b7b7;
        font-size: 24px;
        cursor: pointer;
      }

      .close-modal:hover {
        color: #fff;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        color: #b7b7b7;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .form-control {
        width: 100%;
        padding: 12px 15px;
        background: #222;
        border: 1px solid #333;
        border-radius: 4px;
        color: #fff;
        font-size: 14px;
      }

      .form-control:focus {
        outline: none;
        border-color: #e53637;
      }

      textarea.form-control {
        min-height: 100px;
        resize: vertical;
      }

      .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 100%;
      }

      .file-input-wrapper input[type="file"] {
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
      }

      .file-input-label {
        display: block;
        padding: 12px 15px;
        background: #222;
        border: 1px solid #333;
        border-radius: 4px;
        color: #b7b7b7;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
      }

      .file-input-label:hover {
        border-color: #e53637;
        color: #fff;
      }

      .image-preview {
        margin-top: 10px;
        text-align: center;
      }

      .image-preview img {
        max-width: 100%;
        max-height: 200px;
        border-radius: 4px;
        border: 1px solid #333;
      }

      .current-image {
        margin-top: 10px;
        text-align: center;
      }

      .current-image img {
        max-width: 100%;
        max-height: 150px;
        border-radius: 4px;
        border: 1px solid #333;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 25px;
      }

      .btn-cancel {
        background: #333;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
      }

      .btn-cancel:hover {
        background: #444;
      }

      .btn-save {
        background: #e53637;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
      }

      .btn-save:hover {
        background: #fff;
        color: #e53637;
      }

      @media (max-width: 768px) {
        .admin-header {
          flex-direction: column;
          text-align: center;
          gap: 15px;
        }

        .admin-actions {
          flex-direction: column;
          gap: 15px;
          align-items: stretch;
        }

        .search-box {
          width: 100%;
        }

        .search-input {
          min-width: auto;
          flex: 1;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .modal-content {
          margin: 10% auto;
          padding: 20px;
        }

        .product-card {
          height: 260px;
        }

        .product-image {
          height: 100px;
        }

        .pagination {
          gap: 5px;
        }

        .page-btn {
          padding: 6px 12px;
          font-size: 14px;
        }

        .page-info {
          margin: 0 10px;
          font-size: 12px;
        }
      }
    </style>
  </head>

  <body>
    <div class="admin-container">
      <!-- Admin Header -->
      <div class="admin-header">
        <div class="admin-logo">
          <img src="img/logo.png" alt="Apex Gym" />
          <div class="admin-title">
            <h1>Shop Management</h1>
          </div>
        </div>
        <div class="admin-user">
          <button
            class="btn-primary"
            onclick="location.href='admin-dashboard.html'"
          >
            Back to Dashboard
          </button>
        </div>
      </div>

      <!-- Navigation -->
      <div class="admin-nav">
        <a href="admin-dashboard.html" class="nav-btn">Dashboard</a>
        <a href="admin-shop.html" class="nav-btn active">Shop</a>
        <a href="admin-blog.html" class="nav-btn">Blog</a>
        <a href="admin-users.html" class="nav-btn">Users</a>
        <a href="admin-orders.html" class="nav-btn">Orders</a>
      </div>

      <!-- Actions -->
      <div class="admin-actions">
        <div class="search-box">
          <input
            type="text"
            class="search-input"
            placeholder="Search products..."
            id="searchInput"
          />
          <button class="btn-primary" onclick="searchProducts()">Search</button>
        </div>
        <button class="btn-primary" onclick="openAddProductModal()">
          <i class="fa fa-plus"></i> Add New Product
        </button>
      </div>

      <!-- Products Grid -->
      <div class="products-grid" id="productsGrid">
        <!-- Products will be loaded here dynamically -->
      </div>

      <!-- Pagination -->
      <div class="pagination" id="pagination" style="display: none">
        <button
          class="page-btn"
          id="prevPage"
          onclick="changePage(currentPage - 1)"
        >
          Previous
        </button>
        <span class="page-info" id="pageInfo">Page 1 of 1</span>
        <button
          class="page-btn"
          id="nextPage"
          onclick="changePage(currentPage + 1)"
        >
          Next
        </button>
      </div>

      <!-- Empty State -->
      <div class="empty-state" id="emptyState" style="display: none">
        <i class="fa fa-shopping-bag"></i>
        <h3>No Products Found</h3>
        <p>Get started by adding your first product to the shop.</p>
        <button
          class="btn-primary"
          onclick="openAddProductModal()"
          style="margin-top: 15px"
        >
          Add First Product
        </button>
      </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div id="productModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" id="modalTitle">Add New Product</h2>
          <button class="close-modal" onclick="closeProductModal()">
            &times;
          </button>
        </div>
        <form id="productForm" enctype="multipart/form-data">
          <input type="hidden" id="productId" />
          <input type="hidden" id="existingImage" />

          <div class="form-group">
            <label class="form-label" for="productName">Product Name</label>
            <input type="text" class="form-control" id="productName" required />
          </div>

          <div class="form-group">
            <label class="form-label" for="productDescription"
              >Description</label
            >
            <textarea
              class="form-control"
              id="productDescription"
              required
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="productPrice">Price (₦)</label>
              <input
                type="number"
                class="form-control"
                id="productPrice"
                step="0.01"
                min="0"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label" for="productStock"
                >Stock Quantity</label
              >
              <input
                type="number"
                class="form-control"
                id="productStock"
                min="0"
                required
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="productCategory">Category</label>
              <select class="form-control" id="productCategory" required>
                <option value="">Select Category</option>
                <option value="supplements">Supplements</option>
                <option value="equipment">Equipment</option>
                <option value="apparel">Apparel</option>
                <option value="accessories">Accessories</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="productStatus">Status</label>
              <select class="form-control" id="productStatus" required>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="out-of-stock">Out of Stock</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Product Image</label>

            <!-- Current Image Display (for edit mode) -->
            <div
              class="current-image"
              id="currentImageContainer"
              style="display: none"
            >
              <p>Current Image:</p>
              <img id="currentImage" src="" alt="Current product image" />
              <p>
                <small>Upload a new image to replace the current one</small>
              </p>
            </div>

            <!-- File Upload -->
            <div class="file-input-wrapper">
              <div class="file-input-label" id="fileInputLabel">
                <i class="fa fa-upload"></i> Choose Image File
              </div>
              <input
                type="file"
                id="productImage"
                name="image"
                accept="image/*"
              />
            </div>

            <!-- Image Preview -->
            <div class="image-preview" id="imagePreview" style="display: none">
              <p>Image Preview:</p>
              <img id="previewImage" src="" alt="Image preview" />
            </div>

            <!-- URL Fallback -->
            <div style="margin-top: 10px">
              <label class="form-label" for="imageUrl"
                >Or enter image URL</label
              >
              <input
                type="url"
                class="form-control"
                id="imageUrl"
                placeholder="https://example.com/image.jpg"
              />
            </div>
          </div>

          <div class="modal-actions">
            <button
              type="button"
              class="btn-cancel"
              onclick="closeProductModal()"
            >
              Cancel
            </button>
            <button type="submit" class="btn-save" id="saveButton">
              Save Product
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      let products = [];
      let currentPage = 1;
      const itemsPerPage = 20;
      let totalPages = 1;
      let totalItems = 0;

      document.addEventListener("DOMContentLoaded", function () {
        // Check authentication
        if (localStorage.getItem("admin_authenticated") !== "true") {
          window.location.href = "admin-login.html";
          return;
        }

        loadProducts(currentPage);
        setupEventListeners();
      });

      function setupEventListeners() {
        document
          .getElementById("productForm")
          .addEventListener("submit", saveProduct);
        document
          .getElementById("searchInput")
          .addEventListener("input", searchProducts);

        // Image preview functionality
        document
          .getElementById("productImage")
          .addEventListener("change", function (e) {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = function (e) {
                document.getElementById("previewImage").src = e.target.result;
                document.getElementById("imagePreview").style.display = "block";
                document.getElementById("imageUrl").value = ""; // Clear URL if file is selected
              };
              reader.readAsDataURL(file);
            }
          });

        // URL input clears file input
        document
          .getElementById("imageUrl")
          .addEventListener("input", function () {
            if (this.value) {
              document.getElementById("productImage").value = "";
              document.getElementById("imagePreview").style.display = "none";
            }
          });
      }

      async function loadProducts(page = 1) {
        try {
          showLoadingState();

          const response = await fetch(
            `/admin/shop-items?page=${page}&limit=${itemsPerPage}`
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          products = data.data;
          currentPage = data.pagination.currentPage;
          totalPages = data.pagination.totalPages;
          totalItems = data.pagination.totalItems;

          renderProducts(products);
          updatePagination();
        } catch (error) {
          console.error("Error loading products:", error);
          showErrorState("Failed to load products: " + error.message);
        }
      }

      function changePage(page) {
        if (page < 1 || page > totalPages) return;
        loadProducts(page);
      }

      function updatePagination() {
        const pagination = document.getElementById("pagination");
        const prevBtn = document.getElementById("prevPage");
        const nextBtn = document.getElementById("nextPage");
        const pageInfo = document.getElementById("pageInfo");

        if (totalPages <= 1) {
          pagination.style.display = "none";
          return;
        }

        pagination.style.display = "flex";
        pageInfo.textContent = `Page ${currentPage} of ${totalPages} (${totalItems} total products)`;

        prevBtn.disabled = currentPage === 1;
        prevBtn.className =
          currentPage === 1 ? "page-btn disabled" : "page-btn";

        nextBtn.disabled = currentPage === totalPages;
        nextBtn.className =
          currentPage === totalPages ? "page-btn disabled" : "page-btn";
      }

      function showLoadingState() {
        const productsGrid = document.getElementById("productsGrid");
        const emptyState = document.getElementById("emptyState");
        const pagination = document.getElementById("pagination");

        productsGrid.style.display = "grid";
        emptyState.style.display = "block";
        pagination.style.display = "none";
        emptyState.innerHTML = `
          <i class="fa fa-spinner fa-spin" style="font-size: 48px; margin-bottom: 20px;"></i>
          <h3>Loading Products...</h3>
          <p>Please wait while we load the products.</p>
        `;
      }

      function showErrorState(message) {
        const productsGrid = document.getElementById("productsGrid");
        const emptyState = document.getElementById("emptyState");
        const pagination = document.getElementById("pagination");

        productsGrid.style.display = "grid";
        emptyState.style.display = "block";
        pagination.style.display = "none";
        emptyState.innerHTML = `
          <i class="fa fa-exclamation-triangle" style="font-size: 48px; color: #e53637; margin-bottom: 20px;"></i>
          <h3>Error Loading Products</h3>
          <p>${message}</p>
          <button class="btn-primary" onclick="loadProducts(currentPage)" style="margin-top: 15px;">
            <i class="fa fa-refresh"></i> Try Again
          </button>
        `;
      }

      function renderProducts(productsToRender) {
        const productsGrid = document.getElementById("productsGrid");
        const emptyState = document.getElementById("emptyState");

        if (!productsToRender || productsToRender.length === 0) {
          productsGrid.style.display = "grid";
          emptyState.style.display = "block";
          emptyState.innerHTML = `
            <i class="fa fa-shopping-bag" style="font-size: 48px; margin-bottom: 20px;"></i>
            <h3>No Products Found</h3>
            <p>Get started by adding your first product to the shop.</p>
            <button class="btn-primary" onclick="openAddProductModal()" style="margin-top: 15px;">
              Add First Product
            </button>
          `;
          return;
        }

        productsGrid.style.display = "grid";
        emptyState.style.display = "none";

        productsGrid.innerHTML = productsToRender
          .map(
            (product) => `
            <div class="product-card">
              <div class="product-image">
                <img src="${
                  product.image_url ||
                  "https://via.placeholder.com/400x200/222/666?text=No+Image"
                }" 
                     alt="${product.name}" 
                     onerror="this.src='https://via.placeholder.com/400x200/222/666?text=No+Image'">
                ${
                  product.stock === 0
                    ? '<div class="out-of-stock">Out of Stock</div>'
                    : ""
                }
              </div>
              <div class="product-details">
                <div class="product-name">${product.name}</div>
                <div class="product-description">${
                  product.description || "No description available"
                }</div>
                <div class="product-meta">
                  <div class="product-price">₦${
                    typeof product.price === "number"
                      ? product.price.toLocaleString()
                      : "0"
                  }</div>
                  <div class="product-stock">${
                    product.stock || 0
                  } in stock</div>
                </div>
                <div class="product-actions">
                  <button class="btn-edit" onclick="editProduct(${product.id})">
                    <i class="fa fa-edit"></i> Edit
                  </button>
                  <button class="btn-delete" onclick="deleteProduct(${
                    product.id
                  })">
                    <i class="fa fa-trash"></i> Delete
                  </button>
                </div>
              </div>
            </div>
          `
          )
          .join("");
      }

      function searchProducts() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();

        if (!products || products.length === 0) return;

        const filteredProducts = products.filter(
          (product) =>
            product.name.toLowerCase().includes(searchTerm) ||
            (product.description &&
              product.description.toLowerCase().includes(searchTerm)) ||
            (product.category &&
              product.category.toLowerCase().includes(searchTerm))
        );

        if (searchTerm === "") {
          renderProducts(products);
        } else {
          renderFilteredProducts(filteredProducts);
        }
      }

      function renderFilteredProducts(filteredProducts) {
        const productsGrid = document.getElementById("productsGrid");
        const emptyState = document.getElementById("emptyState");
        const pagination = document.getElementById("pagination");

        if (filteredProducts.length === 0) {
          productsGrid.style.display = "grid";
          emptyState.style.display = "block";
          pagination.style.display = "none";
          emptyState.innerHTML = `
            <i class="fa fa-search"></i>
            <h3>No Products Found</h3>
            <p>No products match your search criteria.</p>
          `;
          return;
        }

        productsGrid.style.display = "grid";
        emptyState.style.display = "none";
        pagination.style.display = "none";

        productsGrid.innerHTML = filteredProducts
          .map(
            (product) => `
            <div class="product-card">
              <div class="product-image">
                <img src="${
                  product.image_url ||
                  "https://via.placeholder.com/400x200/222/666?text=No+Image"
                }" 
                     alt="${product.name}" 
                     onerror="this.src='https://via.placeholder.com/400x200/222/666?text=No+Image'">
                ${
                  product.stock === 0
                    ? '<div class="out-of-stock">Out of Stock</div>'
                    : ""
                }
              </div>
              <div class="product-details">
                <div class="product-name">${product.name}</div>
                <div class="product-description">${
                  product.description || "No description available"
                }</div>
                <div class="product-meta">
                  <div class="product-price">₦${
                    typeof product.price === "number"
                      ? product.price.toLocaleString()
                      : "0"
                  }</div>
                  <div class="product-stock">${
                    product.stock || 0
                  } in stock</div>
                </div>
                <div class="product-actions">
                  <button class="btn-edit" onclick="editProduct(${product.id})">
                    <i class="fa fa-edit"></i> Edit
                  </button>
                  <button class="btn-delete" onclick="deleteProduct(${
                    product.id
                  })">
                    <i class="fa fa-trash"></i> Delete
                  </button>
                </div>
              </div>
            </div>
          `
          )
          .join("");
      }

      function openAddProductModal() {
        document.getElementById("modalTitle").textContent = "Add New Product";
        document.getElementById("productForm").reset();
        document.getElementById("productId").value = "";
        document.getElementById("existingImage").value = "";
        document.getElementById("currentImageContainer").style.display = "none";
        document.getElementById("imagePreview").style.display = "none";
        document.getElementById("fileInputLabel").innerHTML =
          '<i class="fa fa-upload"></i> Choose Image File';
        document.getElementById("productModal").style.display = "block";
      }

      function closeProductModal() {
        document.getElementById("productModal").style.display = "none";
      }

      function editProduct(id) {
        const product = products.find((p) => p.id === id);
        if (!product) return;

        document.getElementById("modalTitle").textContent = "Edit Product";
        document.getElementById("productId").value = product.id;
        document.getElementById("productName").value = product.name;
        document.getElementById("productDescription").value =
          product.description || "";
        document.getElementById("productPrice").value = product.price;
        document.getElementById("productStock").value = product.stock;
        document.getElementById("productCategory").value =
          product.category || "";
        document.getElementById("productStatus").value =
          product.status || "active";
        document.getElementById("imageUrl").value = product.image_url || "";
        document.getElementById("existingImage").value =
          product.image_url || "";

        // Show current image
        if (product.image_url) {
          document.getElementById("currentImage").src = product.image_url;
          document.getElementById("currentImageContainer").style.display =
            "block";
        } else {
          document.getElementById("currentImageContainer").style.display =
            "none";
        }

        document.getElementById("imagePreview").style.display = "none";
        document.getElementById("fileInputLabel").innerHTML =
          '<i class="fa fa-upload"></i> Choose New Image File';

        document.getElementById("productModal").style.display = "block";
      }

      async function saveProduct(e) {
        e.preventDefault();

        const productId = document.getElementById("productId").value;
        const formData = new FormData();

        // Add product data
        formData.append("name", document.getElementById("productName").value);
        formData.append(
          "description",
          document.getElementById("productDescription").value
        );
        formData.append("price", document.getElementById("productPrice").value);
        formData.append("stock", document.getElementById("productStock").value);
        formData.append(
          "category",
          document.getElementById("productCategory").value
        );
        formData.append(
          "status",
          document.getElementById("productStatus").value
        );

        // Handle image - either file or URL
        const imageFile = document.getElementById("productImage").files[0];
        const imageUrl = document.getElementById("imageUrl").value;
        const existingImage = document.getElementById("existingImage").value;

        if (imageFile) {
          formData.append("image", imageFile);
        } else if (imageUrl) {
          formData.append("image", imageUrl);
        } else if (existingImage && !productId) {
          // For new products with existing image URL from edit mode
          formData.append("image", existingImage);
        } else if (existingImage && productId) {
          formData.append("existingImage", existingImage);
        }

        try {
          const saveButton = document.getElementById("saveButton");
          saveButton.textContent = "Saving...";
          saveButton.disabled = true;

          let response;
          if (productId) {
            // Update existing product
            response = await fetch(`/admin/shop-items/${productId}`, {
              method: "PUT",
              body: formData,
            });
          } else {
            // Add new product
            response = await fetch("/admin/shop-items", {
              method: "POST",
              body: formData,
            });
          }

          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(
              errorText || `HTTP error! status: ${response.status}`
            );
          }

          await loadProducts(currentPage);
          closeProductModal();
          alert("Product saved successfully!");
        } catch (error) {
          console.error("Error saving product:", error);
          alert("Error saving product: " + error.message);
        } finally {
          const saveButton = document.getElementById("saveButton");
          saveButton.textContent = "Save Product";
          saveButton.disabled = false;
        }
      }

      async function deleteProduct(id) {
        if (
          confirm(
            "Are you sure you want to delete this product? This action cannot be undone."
          )
        ) {
          try {
            const response = await fetch(`/admin/shop-items/${id}`, {
              method: "DELETE",
            });

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            await loadProducts(currentPage);
            alert("Product deleted successfully!");
          } catch (error) {
            console.error("Error deleting product:", error);
            alert("Error deleting product: " + error.message);
          }
        }
      }

      // Close modal when clicking outside
      window.onclick = function (event) {
        const modal = document.getElementById("productModal");
        if (event.target === modal) {
          closeProductModal();
        }
      };
    </script>
  </body>
</html>
